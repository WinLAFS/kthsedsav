<?xml version="1.0" encoding="UTF-8"?>
<process
    name="bookStoreBPEL2"
    targetNamespace="http://enterprise.netbeans.org/bpel/BookStoreBPEL2/bookStoreBPEL2"
    xmlns:tns="http://enterprise.netbeans.org/bpel/BookStoreBPEL2/bookStoreBPEL2"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor"
    xmlns:sxeh="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" xmlns:sxed2="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor2">
    <import namespace="http://j2ee.netbeans.org/wsdl/BookStoreBPEL2/ClientComposite" location="ClientComposite.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://enterprise.netbeans.org/bpel/AuthorizationWSServiceWrapper" location="AuthorizationWSServiceWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://authorization/" location="BookStore2/wsdl/AuthorizationWSService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <partnerLinks>
        <partnerLink name="AuthorizationPartnerLink" xmlns:tns="http://enterprise.netbeans.org/bpel/AuthorizationWSServiceWrapper" partnerLinkType="tns:AuthorizationWSLinkType" partnerRole="AuthorizationWSRole"/>
        <partnerLink name="PartnerLink1" xmlns:tns="http://j2ee.netbeans.org/wsdl/BookStoreBPEL2/ClientComposite" partnerLinkType="tns:ClientComposite" myRole="ClientCompositePortTypeRole"/>
    </partnerLinks>
    <variables>
        <variable name="LoginOut" xmlns:tns="http://authorization/" messageType="tns:loginResponse"/>
        <variable name="LoginIn" xmlns:tns="http://authorization/" messageType="tns:login"/>
        <variable name="ClientCompositeOperationOut" xmlns:tns="http://j2ee.netbeans.org/wsdl/BookStoreBPEL2/ClientComposite" messageType="tns:ClientCompositeOperationResponse"/>
        <variable name="ClientCompositeOperationIn" xmlns:tns="http://j2ee.netbeans.org/wsdl/BookStoreBPEL2/ClientComposite" messageType="tns:ClientCompositeOperationRequest"/>
    </variables>
    <sequence>
        <receive name="Receive1" createInstance="yes" partnerLink="PartnerLink1" operation="ClientCompositeOperation" xmlns:tns="http://j2ee.netbeans.org/wsdl/BookStoreBPEL2/ClientComposite" portType="tns:ClientCompositePortType" variable="ClientCompositeOperationIn"/>
        <assign name="AssignLogin">
            <copy>
                <from variable="ClientCompositeOperationIn" part="username"/>
                <to>$LoginIn.parameters/arg0</to>
            </copy>
            <copy>
                <from variable="ClientCompositeOperationIn" part="password"/>
                <to>$LoginIn.parameters/arg1</to>
            </copy>
        </assign>
        <invoke name="InvokeLogin" partnerLink="AuthorizationPartnerLink" operation="login" xmlns:tns="http://authorization/" portType="tns:AuthorizationWS" inputVariable="LoginIn" outputVariable="LoginOut"/>
        <if name="If1">
            <condition>$LoginOut.parameters/return/username = 'NOTLOGGED'</condition>
            <assign name="AssignNotLogged">
                <copy>
                    <from>'Not logged'</from>
                    <to variable="ClientCompositeOperationOut" part="part1"/>
                </copy>
            </assign>
            <else>
                <assign name="AssignLogged">
                    <copy>
                        <from>'logged :-)'</from>
                        <to variable="ClientCompositeOperationOut" part="part1"/>
                    </copy>
                </assign>
            </else>
        </if>
        <reply name="Reply1" partnerLink="PartnerLink1" operation="ClientCompositeOperation" xmlns:tns="http://j2ee.netbeans.org/wsdl/BookStoreBPEL2/ClientComposite" portType="tns:ClientCompositePortType" variable="ClientCompositeOperationOut"/>
    </sequence>
</process>


